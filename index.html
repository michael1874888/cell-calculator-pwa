<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç´°èƒåŸ¹é¤Šè¨ˆç®—å™¨</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="å°ˆæ¥­çš„ç´°èƒåŸ¹é¤Šè¨ˆç®—å·¥å…·ï¼Œæ”¯æ´æ™‚é–“ã€ç´°èƒæ•¸ã€ç¨®æ¤æ•¸é‡è¨ˆç®—">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ç´°èƒè¨ˆç®—å™¨">
    <meta name="msapplication-TileColor" content="#2563eb">
    <meta name="msapplication-config" content="browserconfig.xml">
    
    <!-- PWA Icons -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#2563eb">
    <link rel="shortcut icon" href="icons/favicon.ico">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
        .gradient-bg { 
            background: linear-gradient(135deg, #e0f2fe 0%, #e8eaf6 100%); 
        }
        .card { 
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        input[type="number"] { 
            -webkit-appearance: none; 
            -moz-appearance: textfield;
            font-size: 16px; /* é˜²æ­¢iOSç¸®æ”¾ */
            user-select: text; /* å…è¨±è¼¸å…¥æ¡†é¸å–æ–‡å­— */
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        .btn-primary { 
            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
            transition: all 0.3s ease;
            touch-action: manipulation;
        }
        .btn-primary:hover, .btn-primary:active { 
            background: linear-gradient(135deg, #1d4ed8 0%, #2563eb 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(37, 99, 235, 0.3);
        }
        .btn-secondary {
            background: #f3f4f6;
            color: #6b7280;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }
        .btn-secondary:hover, .btn-secondary:active {
            background: #e5e7eb;
            color: #374151;
        }
        .btn-active {
            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
            color: white;
            transform: scale(1.02);
        }
        .result-card { 
            background: linear-gradient(135deg, #f0fdf4 0%, #eff6ff 100%);
            border: 1px solid #e5e7eb;
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .input-focus:focus {
            outline: none;
            ring: 2px;
            ring-color: #3b82f6;
            border-color: transparent;
        }
        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .container { padding: 1rem; }
            .grid-responsive { grid-template-columns: 1fr; gap: 1.5rem; }
            .mode-buttons { flex-direction: column; gap: 0.5rem; }
            .text-responsive { font-size: 1.25rem; }
        }
        @media (min-width: 769px) {
            .grid-responsive { grid-template-columns: 1fr 1fr; gap: 2rem; }
        }
        /* å‹•ç•«æ•ˆæœ */
        .bounce-in {
            animation: bounceIn 0.6s ease-out;
        }
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        /* PWAå®‰è£æç¤º */
        .install-prompt {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
            color: white;
            padding: 1rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.3);
            z-index: 9999;
            transform: translateY(-100px);
            transition: transform 0.3s ease;
        }
        .install-prompt.show {
            transform: translateY(0);
        }
        /* é˜²æ­¢é›™æ“Šç¸®æ”¾ */
        * {
            touch-action: manipulation;
        }
        /* å…è¨±è¼¸å…¥æ¡†æ–‡å­—é¸å– */
        input, textarea {
            user-select: text;
            -webkit-user-select: text;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- PWA å®‰è£æç¤º -->
    <div id="installPrompt" class="install-prompt">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <span class="text-2xl mr-3">ğŸ“±</span>
                <div>
                    <div class="font-bold">å®‰è£æ‡‰ç”¨ç¨‹å¼</div>
                    <div class="text-sm opacity-90">ç²å¾—æ›´å¥½çš„ä½¿ç”¨é«”é©—</div>
                </div>
            </div>
            <div class="flex space-x-2">
                <button id="installBtn" class="bg-white text-blue-600 px-4 py-2 rounded-lg font-medium text-sm">
                    å®‰è£
                </button>
                <button id="dismissBtn" class="text-white opacity-75 hover:opacity-100 text-xl leading-none w-8 h-8">
                    Ã—
                </button>
            </div>
        </div>
    </div>

    <!-- é›¢ç·šæç¤º -->
    <div id="offlineNotice" class="fixed bottom-4 left-4 right-4 bg-yellow-500 text-white p-3 rounded-lg shadow-lg z-50 hidden">
        <div class="flex items-center">
            <span class="mr-2">âš ï¸</span>
            <span class="text-sm">ç›®å‰é›¢ç·šä½¿ç”¨ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½å—é™</span>
        </div>
    </div>

    <div class="container max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <div class="card rounded-3xl shadow-2xl p-6 sm:p-8 lg:p-10">
            <!-- æ¨™é¡Œå€åŸŸ -->
            <div class="text-center mb-8 lg:mb-10">
                <div class="flex items-center justify-center mb-6">
                    <div class="w-12 h-12 lg:w-16 lg:h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center mr-4 bounce-in">
                        <span class="text-white text-2xl lg:text-3xl">ğŸ§¬</span>
                    </div>
                    <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent">
                        ç´°èƒåŸ¹é¤Šè¨ˆç®—å™¨
                    </h1>
                </div>
                <p class="text-gray-600 text-lg lg:text-xl">ç²¾ç¢ºè¨ˆç®—ç´°èƒåŸ¹é¤Šçš„æ™‚é–“å’Œæ•¸é‡</p>
                <!-- ç‰ˆæœ¬è³‡è¨Š -->
                <div class="mt-2 text-xs text-gray-400">
                    PWAç‰ˆæœ¬ v2.0 | æ”¯æ´é›¢ç·šä½¿ç”¨
                </div>
            </div>

            <!-- æ¨¡å¼é¸æ“‡ -->
            <div class="flex justify-center mb-8 lg:mb-10">
                <div class="bg-gray-100 rounded-2xl p-2 inline-flex flex-col sm:flex-row gap-2 mode-buttons">
                    <button id="timeMode" class="mode-btn px-6 py-3 rounded-xl font-medium transition-all text-sm lg:text-base btn-active">
                        <span class="mr-2">â°</span>è¨ˆç®—åŸ¹é¤Šæ™‚é–“
                    </button>
                    <button id="finalCellMode" class="mode-btn px-6 py-3 rounded-xl font-medium transition-all text-sm lg:text-base btn-secondary">
                        <span class="mr-2">ğŸ“ˆ</span>è¨ˆç®—æœ€çµ‚ç´°èƒæ•¸
                    </button>
                    <button id="seedingMode" class="mode-btn px-6 py-3 rounded-xl font-medium transition-all text-sm lg:text-base btn-secondary">
                        <span class="mr-2">ğŸŒ±</span>è¨ˆç®—ç¨®æ¤æ•¸é‡
                    </button>
                </div>
            </div>

            <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
            <div class="grid grid-responsive">
                <!-- å·¦å´ï¼šè¼¸å…¥å€åŸŸ -->
                <div class="space-y-6 lg:space-y-8">
                    <div class="bg-white rounded-2xl shadow-lg p-6 lg:p-8 border border-gray-100">
                        <h2 id="inputTitle" class="text-xl lg:text-2xl font-bold text-gray-800 mb-6 lg:mb-8 border-b border-gray-200 pb-3">
                            è¨ˆç®—æ‰€éœ€åŸ¹é¤Šæ™‚é–“
                        </h2>

                        <!-- ç¨®æ¤ç´°èƒæ•¸è¼¸å…¥ -->
                        <div id="seedingCellsDiv" class="mb-6">
                            <label class="block text-sm lg:text-base font-semibold text-gray-700 mb-3">
                                <span class="flex items-center">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>
                                    ç¨®æ¤ç´°èƒæ•¸ (seeding)
                                </span>
                            </label>
                            <input type="number" id="seedingCells" 
                                   placeholder="ä¾‹ï¼š2500000 æˆ– 2.5e6" 
                                   class="w-full px-4 py-4 lg:py-5 border-2 border-gray-200 rounded-xl input-focus text-base lg:text-lg transition-all">
                            <p class="text-xs lg:text-sm text-gray-500 mt-2">æ”¯æ´ç§‘å­¸è¨˜è™Ÿæ ¼å¼</p>
                        </div>

                        <!-- ç›®æ¨™ç´°èƒæ•¸è¼¸å…¥ -->
                        <div id="targetCellsDiv" class="mb-6">
                            <label class="block text-sm lg:text-base font-semibold text-gray-700 mb-3">
                                <span class="flex items-center">
                                    <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                                    ç›®æ¨™ç´°èƒæ•¸
                                </span>
                            </label>
                            <input type="number" id="targetCells" 
                                   placeholder="ä¾‹ï¼š8000000 æˆ– 8e6"
                                   class="w-full px-4 py-4 lg:py-5 border-2 border-gray-200 rounded-xl input-focus text-base lg:text-lg transition-all">
                            <p class="text-xs lg:text-sm text-gray-500 mt-2">æœŸæœ›é”åˆ°çš„ç´°èƒæ•¸é‡</p>
                        </div>

                        <!-- åŸ¹é¤Šæ™‚é–“è¼¸å…¥ -->
                        <div id="cultureTimeDiv" class="mb-6" style="display: none;">
                            <label class="block text-sm lg:text-base font-semibold text-gray-700 mb-3">
                                <span class="flex items-center">
                                    <span class="w-2 h-2 bg-purple-500 rounded-full mr-2"></span>
                                    åŸ¹é¤Šæ™‚é–“ (å°æ™‚)
                                </span>
                            </label>
                            <input type="number" id="cultureTime" 
                                   placeholder="ä¾‹ï¼š48"
                                   class="w-full px-4 py-4 lg:py-5 border-2 border-gray-200 rounded-xl input-focus text-base lg:text-lg transition-all">
                            <p class="text-xs lg:text-sm text-gray-500 mt-2">å¯¦éš›åŸ¹é¤Šçš„æ™‚é–“é•·åº¦</p>
                        </div>

                        <!-- ç›®æ¨™æœ€çµ‚ç´°èƒæ•¸è¼¸å…¥ -->
                        <div id="targetCellsFinalDiv" class="mb-6" style="display: none;">
                            <label class="block text-sm lg:text-base font-semibold text-gray-700 mb-3">
                                <span class="flex items-center">
                                    <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                                    ç›®æ¨™æœ€çµ‚ç´°èƒæ•¸
                                </span>
                            </label>
                            <input type="number" id="targetCellsFinal" 
                                   placeholder="ä¾‹ï¼š8000000 æˆ– 8e6"
                                   class="w-full px-4 py-4 lg:py-5 border-2 border-gray-200 rounded-xl input-focus text-base lg:text-lg transition-all">
                            <p class="text-xs lg:text-sm text-gray-500 mt-2">å¸Œæœ›æœ€çµ‚é”åˆ°çš„ç´°èƒæ•¸</p>
                        </div>

                        <!-- é è¨ˆåŸ¹é¤Šæ™‚é–“è¼¸å…¥ -->
                        <div id="cultureTimeSeedingDiv" class="mb-6" style="display: none;">
                            <label class="block text-sm lg:text-base font-semibold text-gray-700 mb-3">
                                <span class="flex items-center">
                                    <span class="w-2 h-2 bg-purple-500 rounded-full mr-2"></span>
                                    é è¨ˆåŸ¹é¤Šæ™‚é–“ (å°æ™‚)
                                </span>
                            </label>
                            <input type="number" id="cultureTimeSeeding" 
                                   placeholder="ä¾‹ï¼š48"
                                   class="w-full px-4 py-4 lg:py-5 border-2 border-gray-200 rounded-xl input-focus text-base lg:text-lg transition-all">
                            <p class="text-xs lg:text-sm text-gray-500 mt-2">è¨ˆåŠƒçš„åŸ¹é¤Šæ™‚é–“é•·åº¦</p>
                        </div>

                        <!-- Doubling Timeè¼¸å…¥ -->
                        <div class="mb-8">
                            <label class="block text-sm lg:text-base font-semibold text-gray-700 mb-3">
                                <span class="flex items-center">
                                    <span class="w-2 h-2 bg-orange-500 rounded-full mr-2"></span>
                                    Doubling Time (å°æ™‚)
                                </span>
                            </label>
                            <input type="number" id="doublingTime" 
                                   placeholder="ä¾‹ï¼š26.78"
                                   class="w-full px-4 py-4 lg:py-5 border-2 border-gray-200 rounded-xl input-focus text-base lg:text-lg transition-all">
                            <p class="text-xs lg:text-sm text-gray-500 mt-2">ç´°èƒæ•¸é‡ç¿»å€æ‰€éœ€æ™‚é–“</p>
                        </div>

                        <!-- æŒ‰éˆ•å€åŸŸ -->
                        <div class="flex flex-col sm:flex-row gap-4">
                            <button id="calculateBtn" 
                                    class="btn-primary text-white py-4 lg:py-5 px-8 lg:px-10 rounded-xl font-bold text-base lg:text-lg shadow-lg flex-1 flex items-center justify-center">
                                <span class="mr-2">ğŸ§®</span>é–‹å§‹è¨ˆç®—
                            </button>
                            <button id="resetBtn" 
                                    class="px-8 py-4 lg:py-5 border-2 border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all text-base lg:text-lg font-medium">
                                <span class="mr-2">ğŸ”„</span>é‡ç½®
                            </button>
                        </div>
                    </div>
                </div>

                <!-- å³å´ï¼šçµæœå€åŸŸ -->
                <div class="space-y-6 lg:space-y-8">
                    <div class="bg-white rounded-2xl shadow-lg p-6 lg:p-8 border border-gray-100">
                        <h2 class="text-xl lg:text-2xl font-bold text-gray-800 mb-6 lg:mb-8 border-b border-gray-200 pb-3">
                            è¨ˆç®—çµæœ
                        </h2>
                        
                        <div id="resultArea" class="bg-gradient-to-br from-gray-50 to-blue-50 p-8 lg:p-12 rounded-2xl text-center min-h-[300px] flex items-center justify-center">
                            <div class="text-gray-400">
                                <div class="text-6xl lg:text-8xl mb-6 bounce-in">ğŸ§®</div>
                                <p class="text-gray-600 text-base lg:text-lg">è«‹è¼¸å…¥æ•¸å€¼ä¸¦é»æ“Šè¨ˆç®—æŒ‰éˆ•</p>
                                <p class="text-gray-500 text-sm lg:text-base mt-2">æ”¯æ´ç§‘å­¸è¨˜è™Ÿæ ¼å¼è¼¸å…¥</p>
                            </div>
                        </div>
                    </div>

                    <!-- å…¬å¼èªªæ˜ -->
                    <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-6 lg:p-8 border border-blue-100">
                        <h3 class="font-bold text-blue-800 mb-4 text-base lg:text-lg flex items-center">
                            <span class="w-3 h-3 bg-blue-500 rounded-full mr-3"></span>
                            è¨ˆç®—å…¬å¼
                        </h3>
                        <div class="space-y-4">
                            <div class="bg-white rounded-xl p-4 lg:p-6 border border-blue-200">
                                <div class="font-mono text-xl lg:text-2xl font-bold text-blue-700 mb-3">
                                    N(t) = Nâ‚€ Ã— 2^(t/td)
                                </div>
                                <div class="text-sm lg:text-base text-blue-600 space-y-1">
                                    <div><strong>N(t)</strong>ï¼šæœ€çµ‚ç´°èƒæ•¸</div>
                                    <div><strong>Nâ‚€</strong>ï¼šåˆå§‹ç´°èƒæ•¸</div>
                                    <div><strong>t</strong>ï¼šåŸ¹é¤Šæ™‚é–“</div>
                                    <div><strong>td</strong>ï¼šdoubling time</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentMode = 'time';
        let deferredPrompt;

        // PWA å®‰è£ç›¸é—œ
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // å»¶é²é¡¯ç¤ºå®‰è£æç¤º
            setTimeout(() => {
                const installPrompt = document.getElementById('installPrompt');
                installPrompt.classList.add('show');
            }, 2000);
        });

        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`ç”¨æˆ¶é¸æ“‡ï¼š${outcome}`);
                
                if (outcome === 'accepted') {
                    showAlert('å®‰è£æˆåŠŸï¼å¯ä»¥åœ¨æ¡Œé¢æ‰¾åˆ°æ‡‰ç”¨ç¨‹å¼', 'info');
                }
                
                deferredPrompt = null;
                document.getElementById('installPrompt').classList.remove('show');
            }
        });

        document.getElementById('dismissBtn').addEventListener('click', () => {
            document.getElementById('installPrompt').classList.remove('show');
        });

        // æª¢æ¸¬å®‰è£ç‹€æ…‹
        window.addEventListener('appinstalled', () => {
            showAlert('ç´°èƒè¨ˆç®—å™¨å·²æˆåŠŸå®‰è£ï¼', 'info');
            document.getElementById('installPrompt').classList.remove('show');
        });

        // è¨»å†Š Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('sw.js');
                    console.log('SW registered: ', registration);
                    
                    // æª¢æŸ¥æ›´æ–°
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                showAlert('ç™¼ç¾æ–°ç‰ˆæœ¬ï¼Œè«‹é‡æ–°è¼‰å…¥é é¢', 'info');
                            }
                        });
                    });
                } catch (registrationError) {
                    console.log('SW registration failed: ', registrationError);
                }
            });
        }

        // é›¢ç·š/ç·šä¸Šç‹€æ…‹æª¢æ¸¬
        function updateOnlineStatus() {
            const offlineNotice = document.getElementById('offlineNotice');
            if (navigator.onLine) {
                offlineNotice.classList.add('hidden');
            } else {
                offlineNotice.classList.remove('hidden');
            }
        }

        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        // æ¨¡å¼åˆ‡æ›åŠŸèƒ½
        document.getElementById('timeMode').addEventListener('click', () => {
            currentMode = 'time';
            updateMode();
        });

        document.getElementById('finalCellMode').addEventListener('click', () => {
            currentMode = 'final';
            updateMode();
        });

        document.getElementById('seedingMode').addEventListener('click', () => {
            currentMode = 'seeding';
            updateMode();
        });

        function updateMode() {
            const timeModeBtn = document.getElementById('timeMode');
            const finalCellModeBtn = document.getElementById('finalCellMode');
            const seedingModeBtn = document.getElementById('seedingMode');
            const inputTitle = document.getElementById('inputTitle');

            // é‡ç½®æ‰€æœ‰æŒ‰éˆ•æ¨£å¼
            [timeModeBtn, finalCellModeBtn, seedingModeBtn].forEach(btn => {
                btn.className = 'mode-btn px-6 py-3 rounded-xl font-medium transition-all text-sm lg:text-base btn-secondary';
            });

            // éš±è—æ‰€æœ‰è¼¸å…¥æ¡†
            document.getElementById('seedingCellsDiv').style.display = 'none';
            document.getElementById('targetCellsDiv').style.display = 'none';
            document.getElementById('cultureTimeDiv').style.display = 'none';
            document.getElementById('targetCellsFinalDiv').style.display = 'none';
            document.getElementById('cultureTimeSeedingDiv').style.display = 'none';

            if (currentMode === 'time') {
                timeModeBtn.className = 'mode-btn px-6 py-3 rounded-xl font-medium transition-all text-sm lg:text-base btn-active';
                inputTitle.textContent = 'è¨ˆç®—æ‰€éœ€åŸ¹é¤Šæ™‚é–“';
                document.getElementById('seedingCellsDiv').style.display = 'block';
                document.getElementById('targetCellsDiv').style.display = 'block';
            } else if (currentMode === 'final') {
                finalCellModeBtn.className = 'mode-btn px-6 py-3 rounded-xl font-medium transition-all text-sm lg:text-base btn-active';
                inputTitle.textContent = 'è¨ˆç®—æœ€çµ‚ç´°èƒæ•¸é‡';
                document.getElementById('seedingCellsDiv').style.display = 'block';
                document.getElementById('cultureTimeDiv').style.display = 'block';
            } else if (currentMode === 'seeding') {
                seedingModeBtn.className = 'mode-btn px-6 py-3 rounded-xl font-medium transition-all text-sm lg:text-base btn-active';
                inputTitle.textContent = 'è¨ˆç®—æ‰€éœ€ç¨®æ¤æ•¸é‡';
                document.getElementById('targetCellsFinalDiv').style.display = 'block';
                document.getElementById('cultureTimeSeedingDiv').style.display = 'block';
            }
            resetForm();
        }

        // è¨ˆç®—åŠŸèƒ½
        document.getElementById('calculateBtn').addEventListener('click', calculate);

        function calculate() {
            const doublingTime = parseFloat(document.getElementById('doublingTime').value);

            if (!doublingTime || doublingTime <= 0) {
                showAlert('è«‹å¡«å…¥æœ‰æ•ˆçš„ Doubling Time (å¿…é ˆå¤§æ–¼0)', 'error');
                return;
            }

            try {
                if (currentMode === 'time') {
                    calculateTime(doublingTime);
                } else if (currentMode === 'final') {
                    calculateFinalCells(doublingTime);
                } else if (currentMode === 'seeding') {
                    calculateSeedingCells(doublingTime);
                }
            } catch (error) {
                showAlert('è¨ˆç®—éŒ¯èª¤ï¼š' + error.message, 'error');
            }
        }

        function calculateTime(doublingTime) {
            const seedingCells = parseFloat(document.getElementById('seedingCells').value);
            const targetCells = parseFloat(document.getElementById('targetCells').value);
            
            if (!seedingCells || !targetCells) {
                showAlert('è«‹å¡«å…¥ç¨®æ¤ç´°èƒæ•¸å’Œç›®æ¨™ç´°èƒæ•¸', 'error');
                return;
            }

            if (seedingCells <= 0 || targetCells <= 0) {
                showAlert('ç´°èƒæ•¸å¿…é ˆå¤§æ–¼0', 'error');
                return;
            }

            if (seedingCells >= targetCells) {
                showAlert('ç›®æ¨™ç´°èƒæ•¸å¿…é ˆå¤§æ–¼ç¨®æ¤ç´°èƒæ•¸', 'error');
                return;
            }

            const time = doublingTime * Math.log2(targetCells / seedingCells);
            const days = Math.floor(time / 24);
            const hours = time % 24;
            const doublings = Math.log2(targetCells / seedingCells);

            showTimeResult(time, days, hours, doublings);
        }

        function calculateFinalCells(doublingTime) {
            const seedingCells = parseFloat(document.getElementById('seedingCells').value);
            const cultureTime = parseFloat(document.getElementById('cultureTime').value);
            
            if (!seedingCells || !cultureTime) {
                showAlert('è«‹å¡«å…¥ç¨®æ¤ç´°èƒæ•¸å’ŒåŸ¹é¤Šæ™‚é–“', 'error');
                return;
            }

            if (seedingCells <= 0 || cultureTime <= 0) {
                showAlert('æ•¸å€¼å¿…é ˆå¤§æ–¼0', 'error');
                return;
            }

            const finalCells = seedingCells * Math.pow(2, cultureTime / doublingTime);
            const doublings = cultureTime / doublingTime;
            const foldIncrease = finalCells / seedingCells;

            showCellResult(finalCells, doublings, foldIncrease);
        }

        function calculateSeedingCells(doublingTime) {
            const targetCellsFinal = parseFloat(document.getElementById('targetCellsFinal').value);
            const cultureTimeSeeding = parseFloat(document.getElementById('cultureTimeSeeding').value);
            
            if (!targetCellsFinal || !cultureTimeSeeding) {
                showAlert('è«‹å¡«å…¥ç›®æ¨™æœ€çµ‚ç´°èƒæ•¸å’Œé è¨ˆåŸ¹é¤Šæ™‚é–“', 'error');
                return;
            }

            if (targetCellsFinal <= 0 || cultureTimeSeeding <= 0) {
                showAlert('æ•¸å€¼å¿…é ˆå¤§æ–¼0', 'error');
                return;
            }

            const seedingCells = targetCellsFinal / Math.pow(2, cultureTimeSeeding / doublingTime);
            const doublings = cultureTimeSeeding / doublingTime;
            const foldIncrease = targetCellsFinal / seedingCells;

            showSeedingResult(seedingCells, doublings, foldIncrease, targetCellsFinal);
        }

        function showTimeResult(totalHours, days, hours, doublings) {
            const resultArea = document.getElementById('resultArea');
            resultArea.innerHTML = `
                <div class="result-card p-6 lg:p-8 rounded-2xl">
                    <div class="text-center space-y-6">
                        <div class="bounce-in">
                            <div class="text-4xl lg:text-5xl font-bold text-green-600 mb-3">
                                ${days}å¤© ${hours.toFixed(1)}å°æ™‚
                            </div>
                            <div class="text-gray-600 text-base lg:text-lg">
                                ç¸½è¨ˆï¼š${totalHours.toFixed(2)} å°æ™‚
                            </div>
                        </div>
                        <div class="grid grid-cols-1 gap-4 mt-6">
                            <div class="bg-white p-4 lg:p-6 rounded-xl shadow-sm border border-gray-100">
                                <div class="text-sm lg:text-base text-gray-600 mb-2">ç´°èƒåˆ†è£‚æ¬¡æ•¸</div>
                                <div class="text-2xl lg:text-3xl font-bold text-blue-600">
                                    ${doublings.toFixed(2)} æ¬¡
                                </div>
                            </div>
                        </div>
                        <div class="text-xs lg:text-sm text-gray-500 mt-4">
                            âœ¨ åŸºæ–¼æŒ‡æ•¸å¢é•·æ¨¡å‹è¨ˆç®—
                        </div>
                    </div>
                </div>
            `;
        }

        function showCellResult(finalCells, doublings, foldIncrease) {
            const resultArea = document.getElementById('resultArea');
            const formattedCells = finalCells.toExponential(2);
            const readableCells = formatNumber(finalCells);
            
            resultArea.innerHTML = `
                <div class="result-card p-6 lg:p-8 rounded-2xl">
                    <div class="text-center space-y-6">
                        <div class="bounce-in">
                            <div class="text-2xl lg:text-3xl font-bold text-green-600 mb-3">
                                ${formattedCells}
                            </div>
                            <div class="text-gray-600 text-base lg:text-lg">
                                ç´„ ${readableCells} å€‹ç´°èƒ
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mt-6">
                            <div class="bg-white p-4 lg:p-6 rounded-xl shadow-sm border border-gray-100">
                                <div class="text-sm lg:text-base text-gray-600 mb-2">åˆ†è£‚æ¬¡æ•¸</div>
                                <div class="text-xl lg:text-2xl font-bold text-blue-600">
                                    ${doublings.toFixed(2)} æ¬¡
                                </div>
                            </div>
                            <div class="bg-white p-4 lg:p-6 rounded-xl shadow-sm border border-gray-100">
                                <div class="text-sm lg:text-base text-gray-600 mb-2">å¢é•·å€æ•¸</div>
                                <div class="text-xl lg:text-2xl font-bold text-purple-600">
                                    ${foldIncrease.toFixed(2)}x
                                </div>
                            </div>
                        </div>
                        <div class="text-xs lg:text-sm text-gray-500 mt-4">
                            ğŸ“Š ç²¾ç¢ºè¨ˆç®—çµæœ
                        </div>
                    </div>
                </div>
            `;
        }

        function showSeedingResult(seedingCells, doublings, foldIncrease, targetCells) {
            const resultArea = document.getElementById('resultArea');
            const formattedSeeding = seedingCells.toExponential(2);
            const readableSeeding = formatNumber(seedingCells);
            const formattedTarget = formatNumber(targetCells);
            
            resultArea.innerHTML = `
                <div class="result-card p-6 lg:p-8 rounded-2xl">
                    <div class="text-center space-y-6">
                        <div class="bounce-in">
                            <div class="text-lg lg:text-xl text-gray-700 mb-2">éœ€è¦ç¨®æ¤</div>
                            <div class="text-2xl lg:text-3xl font-bold text-green-600 mb-3">
                                ${formattedSeeding}
                            </div>
                            <div class="text-gray-600 text-base lg:text-lg">
                                ç´„ ${readableSeeding} å€‹ç´°èƒ
                            </div>
                            <div class="text-sm lg:text-base text-gray-500 mt-3">
                                åŸ¹é¤Šå¾Œå°‡é”åˆ° ${formattedTarget} å€‹ç´°èƒ
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mt-6">
                            <div class="bg-white p-4 lg:p-6 rounded-xl shadow-sm border border-gray-100">
                                <div class="text-sm lg:text-base text-gray-600 mb-2">åˆ†è£‚æ¬¡æ•¸</div>
                                <div class="text-xl lg:text-2xl font-bold text-blue-600">
                                    ${doublings.toFixed(2)} æ¬¡
                                </div>
                            </div>
                            <div class="bg-white p-4 lg:p-6 rounded-xl shadow-sm border border-gray-100">
                                <div class="text-sm lg:text-base text-gray-600 mb-2">å¢é•·å€æ•¸</div>
                                <div class="text-xl lg:text-2xl font-bold text-purple-600">
                                    ${foldIncrease.toFixed(2)}x
                                </div>
                            </div>
                        </div>
                        <div class="text-xs lg:text-sm text-gray-500 mt-4">
                            ğŸ¯ åæ¨è¨ˆç®—çµæœ
                        </div>
                    </div>
                </div>
            `;
        }

        function formatNumber(num) {
            if (num >= 1e12) {
                return (num / 1e12).toFixed(2) + 'T';
            } else if (num >= 1e9) {
                return (num / 1e9).toFixed(2) + 'B';
            } else if (num >= 1e6) {
                return (num / 1e6).toFixed(2) + 'M';
            } else if (num >= 1e3) {
                return (num / 1e3).toFixed(2) + 'K';
            }
            return Math.round(num).toLocaleString();
        }

        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            const bgColor = type === 'error' ? 'bg-red-100 border-red-500 text-red-700' : 'bg-blue-100 border-blue-500 text-blue-700';
            
            alertDiv.className = `fixed top-4 right-4 ${bgColor} border-l-4 p-4 rounded-lg shadow-lg z-50 max-w-sm bounce-in`;
            alertDiv.innerHTML = `
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <span class="text-xl">${type === 'error' ? 'âš ï¸' : 'â„¹ï¸'}</span>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-medium">${message}</p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-lg leading-none">Ã—</button>
                </div>
            `;
            
            document.body.appendChild(alertDiv);
            
            // 3ç§’å¾Œè‡ªå‹•æ¶ˆå¤±
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 3000);
        }

        // é‡ç½®åŠŸèƒ½
        document.getElementById('resetBtn').addEventListener('click', resetForm);

        function resetForm() {
            // æ¸…ç©ºæ‰€æœ‰è¼¸å…¥æ¡†
            document.getElementById('seedingCells').value = '';
            document.getElementById('targetCells').value = '';
            document.getElementById('cultureTime').value = '';
            document.getElementById('doublingTime').value = '';
            document.getElementById('targetCellsFinal').value = '';
            document.getElementById('cultureTimeSeeding').value = '';
            
            // é‡ç½®çµæœé¡¯ç¤º
            const resultArea = document.getElementById('resultArea');
            resultArea.innerHTML = `
                <div class="bg-gradient-to-br from-gray-50 to-blue-50 p-8 lg:p-12 rounded-2xl text-center min-h-[300px] flex items-center justify-center">
                    <div class="text-gray-400">
                        <div class="text-6xl lg:text-8xl mb-6 bounce-in">ğŸ§®</div>
                        <p class="text-gray-600 text-base lg:text-lg">è«‹è¼¸å…¥æ•¸å€¼ä¸¦é»æ“Šè¨ˆç®—æŒ‰éˆ•</p>
                        <p class="text-gray-500 text-sm lg:text-base mt-2">æ”¯æ´ç§‘å­¸è¨˜è™Ÿæ ¼å¼è¼¸å…¥</p>
                    </div>
                </div>
            `;
            
            showAlert('å·²é‡ç½®æ‰€æœ‰è¼¸å…¥', 'info');
        }

        // éµç›¤å¿«æ·éµæ”¯æ´ï¼ˆä¿®æ­£ç‰ˆæœ¬ï¼‰
        document.addEventListener('keydown', (e) => {
            // æª¢æŸ¥æ˜¯å¦åœ¨è¼¸å…¥æ¡†ä¸­ï¼Œå¦‚æœæ˜¯å‰‡ä¸åŸ·è¡Œå¿«æ·éµ
            const isInInput = e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA';
            
            // Enteréµè¨ˆç®—ï¼ˆåªåœ¨è¼¸å…¥æ¡†ä¸­ç”Ÿæ•ˆï¼‰
            if (e.key === 'Enter' && isInInput) {
                e.preventDefault();
                calculate();
            }
            
            // å…¶ä»–å¿«æ·éµåªåœ¨éè¼¸å…¥ç‹€æ…‹ä¸‹ç”Ÿæ•ˆ
            if (!isInInput) {
                // Escapeéµé‡ç½®
                if (e.key === 'Escape') {
                    resetForm();
                }
                
                // æ•¸å­—éµåˆ‡æ›æ¨¡å¼ï¼ˆåªåœ¨éè¼¸å…¥ç‹€æ…‹ä¸‹ï¼‰
                if (e.key === '1') {
                    currentMode = 'time';
                    updateMode();
                }
                if (e.key === '2') {
                    currentMode = 'final';
                    updateMode();
                }
                if (e.key === '3') {
                    currentMode = 'seeding';
                    updateMode();
                }
                
                // å•è™Ÿéµé¡¯ç¤ºå¿«æ·éµ
                if (e.key === '?') {
                    showShortcuts();
                }
            }
        });

        // æ·»åŠ å¿«æ·éµèªªæ˜
        function showShortcuts() {
            showAlert('å¿«æ·éµï¼šè¼¸å…¥æ¡†å…§æŒ‰Enterè¨ˆç®— | éè¼¸å…¥æ™‚æŒ‰1/2/3åˆ‡æ›æ¨¡å¼ | Escé‡ç½®', 'info');
        }

        // è¼¸å…¥æ¡†å¢å¼·åŠŸèƒ½
        function addInputHelpers() {
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.style.borderColor = '#3b82f6';
                    this.style.boxShadow = '0 0 0 3px rgba(59, 130, 246, 0.1)';
                });

                input.addEventListener('blur', function() {
                    this.style.borderColor = '#d1d5db';
                    this.style.boxShadow = 'none';
                });
            });
        }

        // è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateMode();
            addInputHelpers();
            updateOnlineStatus();
            
            // é¡¯ç¤ºæ­¡è¿è¨Šæ¯
            setTimeout(() => {
                showAlert('æ­¡è¿ä½¿ç”¨ç´°èƒåŸ¹é¤Šè¨ˆç®—å™¨ PWA ç‰ˆï¼', 'info');
            }, 1000);
        });

        // åœ¨é é¢åº•éƒ¨æ·»åŠ å¿«æ·éµæç¤º
        setTimeout(() => {
            const shortcutTip = document.createElement('div');
            shortcutTip.className = 'fixed bottom-4 left-4 bg-black bg-opacity-70 text-white text-xs px-3 py-2 rounded-lg z-40 cursor-pointer';
            shortcutTip.innerHTML = 'ğŸ’¡ æŒ‰ ? æŸ¥çœ‹å¿«æ·éµ';
            shortcutTip.onclick = showShortcuts;
            document.body.appendChild(shortcutTip);
        }, 5000);
    </script>
</body>
</html>